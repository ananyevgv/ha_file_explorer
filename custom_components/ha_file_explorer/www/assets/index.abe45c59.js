var W=Object.defineProperty,X=Object.defineProperties;var Y=Object.getOwnPropertyDescriptors;var R=Object.getOwnPropertySymbols;var Z=Object.prototype.hasOwnProperty,ee=Object.prototype.propertyIsEnumerable;var q=(l,e,i)=>e in l?W(l,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):l[e]=i,L=(l,e)=>{for(var i in e||(e={}))Z.call(e,i)&&q(l,i,e[i]);if(R)for(var i of R(e))ee.call(e,i)&&q(l,i,e[i]);return l},z=(l,e)=>X(l,Y(e));import{d as D,r as I,a as o,o as _,c as y,w as t,b as a,e as U,f as P,g as j,F as A,h as d,u as B,t as s,i as r,j as te,k as H,_ as T,l as E,m as ae,n as M,p as K,q as N}from"./index.5274938f.js";import{l as n,_ as le}from"./AppLayout.e91c6a4e.js";const oe={class:"va-table"},ne=["href"],se={key:1},ie=d(" OK "),ce=D({name:"VersionInfo",props:["ok"],setup(l){const e=l;B();const i="File Explorer",c=I(!0),F=new URLSearchParams(location.search),V=I([{name:"Version",value:F.get("v")||"dev"},{name:"Author",value:"shaonianzhentan"},{name:"Link",value:"https://github.com/shaonianzhentan/ha_file_explorer",type:"link"},{name:"UI",value:"https://vuestic.dev",type:"link"},{name:"Icon",value:"https://unpkg.com/@mdi/font@latest/preview.html",type:"link"},{name:"Bilibili",value:"https://space.bilibili.com/39523884",type:"link"},{name:"HA notes",value:"https://ha.jiluxinqing.com",type:"link"}]),m=async()=>{e.ok({})};return(b,k)=>{const g=o("va-button"),$=o("va-modal");return _(),y($,{modelValue:c.value,"onUpdate:modelValue":k[0]||(k[0]=u=>c.value=u),title:i,"hide-default-actions":!0},{footer:t(()=>[a(g,{onClick:m},{default:t(()=>[ie]),_:1})]),default:t(()=>[U("table",oe,[U("tbody",null,[(_(!0),P(A,null,j(V.value,u=>(_(),P("tr",{key:u.name},[U("td",null,s(u.name),1),U("td",null,[u.type==="link"?(_(),P("a",{key:0,href:u.value,target:"_blank"},s(u.value),9,ne)):(_(),P("span",se,s(u.value),1))])]))),128))])])]),_:1},8,["modelValue"])}}}),re={},O=D(z(L({},re),{name:"CreateFile",props:["type","ok","cancel","app"],setup(l){const e=l,i=B(),c=e.type==="file",F=c?n.file:n.folder,V=e.app(),m=I(""),b=I(!0),k=()=>{e.cancel()},g=async()=>{if(!m.value)return;const $=i.getters.absolutePath(m.value);let u=await H.service.createHassFile(c?"file":"folder",$);V.$toast(u.msg),!(u.code>0)&&(i.dispatch("reloadFileList"),e.ok({}))};return($,u)=>{const p=o("va-input"),f=o("va-button"),v=o("va-modal");return _(),y(v,{modelValue:b.value,"onUpdate:modelValue":u[1]||(u[1]=w=>b.value=w),title:r(F),"hide-default-actions":!0},{footer:t(()=>[a(f,{outline:"",onClick:k,style:{"margin-right":"20px"}},{default:t(()=>[d(s(r(n).cancel),1)]),_:1}),a(f,{onClick:g,style:{"margin-left":"20px"}},{default:t(()=>[d(s(r(n).confirm),1)]),_:1})]),default:t(()=>[a(p,{modelValue:m.value,"onUpdate:modelValue":u[0]||(u[0]=w=>m.value=w),modelModifiers:{trim:!0},onKeypress:te(g,["enter"]),placeholder:r(n).newName(r(F))},null,8,["modelValue","onKeypress","placeholder"])]),_:1},8,["modelValue","title"])}}}));const ue={class:"file-panel"},de={},_e=D(z(L({},de),{name:"UploadFile",props:["type","ok","cancel","app"],setup(l){const e=l,i=B(),c=e.type==="file",F=`${n.upload} ${c?n.file:n.folder}`,V=e.app(),m=I([]),b=I(!0),k=I(!1),g=p=>{console.log(p.target.files);const f=[];for(let v of p.target.files)f.push(v);m.value=f},$=()=>{e.cancel()},u=async()=>{if(m.value.length===0)return;k.value=!0;let p=0;const f=m.value.length;for(let v=0;v<m.value.length;v++){const w=m.value[v];try{const h=i.getters.absolutePath(c?w.name:w.webkitRelativePath),C=await H.service.uploadFile(h,w);m.value.splice(v,1),v--}catch(h){console.error(`Failed to upload ${w.name}:`,h)}p++}V.$toast(n.uploadSuccess(f,p)),i.dispatch("reloadFileList"),f-p==0&&e.ok(),k.value=!1};return(p,f)=>{const v=o("va-progress-bar"),w=o("va-alert"),h=o("va-file-upload"),C=o("va-button"),S=o("va-modal");return _(),y(S,{modelValue:b.value,"onUpdate:modelValue":f[1]||(f[1]=x=>b.value=x),title:F,"hide-default-actions":!0},{footer:t(()=>[a(C,{disabled:k.value,outline:"",onClick:$,style:{"margin-right":"20px"}},{default:t(()=>[d(s(r(n).cancel),1)]),_:1},8,["disabled"]),a(C,{disabled:k.value,onClick:u,style:{"margin-left":"20px"}},{default:t(()=>[d(s(r(n).confirm),1)]),_:1},8,["disabled"])]),default:t(()=>[k.value?(_(),y(v,{key:0,indeterminate:""})):E("",!0),a(w,{color:"danger",class:"mb-4"},{default:t(()=>[d(s(r(n).uploadTips),1)]),_:1}),c?(_(),y(h,{key:1,disabled:k.value,modelValue:m.value,"onUpdate:modelValue":f[0]||(f[0]=x=>m.value=x)},null,8,["disabled","modelValue"])):(_(),P("input",{key:2,type:"file",onChange:g,webkitdirectory:""},null,32)),U("div",ue,[U("ol",null,[(_(!0),P(A,null,j(m.value,(x,Q)=>(_(),P("li",{key:Q},s(x.webkitRelativePath),1))),128))])])]),_:1},8,["modelValue"])}}}));var G=T(_e,[["__scopeId","data-v-47b7be92"]]);const pe={},J=D(z(L({},pe),{name:"RenameFile",props:["type","name","ok","cancel","app"],setup(l){const e=l,i=B(),c=e.type==="file",F=c?n.file:n.folder,V=ae(()=>{if(c)return e.name;const p=i.getters.absolutePath(e.name).split("/");return p.splice(p.length-1,1),p[p.length-1]}),m=e.app(),b=I(""),k=I(!0),g=()=>{e.cancel()},$=async()=>{if(!b.value)return;let u=i.getters.absolutePath(e.name),p=i.getters.absolutePath(b.value);if(!c){const v=u.split("/");v.splice(v.length-1,1),u=v.join("/"),v[v.length-1]=b.value,p=v.join("/")}let f=await H.service.rename(u,p);m.$toast(f.msg),!(f.code>0)&&(i.dispatch("reloadFileList",c?"":p),e.ok({}))};return(u,p)=>{const f=o("va-alert"),v=o("va-input"),w=o("va-button"),h=o("va-modal");return _(),y(h,{modelValue:k.value,"onUpdate:modelValue":p[1]||(p[1]=C=>k.value=C),title:r(F),"hide-default-actions":!0},{footer:t(()=>[a(w,{outline:"",onClick:g,style:{"margin-right":"20px"}},{default:t(()=>[d(s(r(n).cancel),1)]),_:1}),a(w,{onClick:$,style:{"margin-left":"20px"}},{default:t(()=>[d(s(r(n).confirm),1)]),_:1})]),default:t(()=>[a(f,{outline:""},{default:t(()=>[d(s(r(n).currentName)+"\uFF1A"+s(r(V)),1)]),_:1}),a(v,{modelValue:b.value,"onUpdate:modelValue":p[0]||(p[0]=C=>b.value=C),modelModifiers:{trim:!0},placeholder:r(n).newName(r(F))},null,8,["modelValue","placeholder"])]),_:1},8,["modelValue","title"])}}})),me=["onClick"],ve={computed:z(L(L({},M(["fileList"])),K(["absolutePath"])),{isLocalDir(){return this.absolutePath("")==="./www/"}}),methods:z(L({},N(["reloadFileList"])),{deleteClick(l){parent.confirm(n.deleteConfirm(l))&&this.api.service.deleteHassFile(this.absolutePath(l)).then(e=>{this.reloadFileList(),this.$toast(e.msg)})},browseClick(l){window.open(`/local/${l}`)},renameClick(l){this.$dialog(J,{type:"file",name:l})},editClick(l){let e=l.lastIndexOf(".");if(e>0){let i=l.substring(e+1);if(["db","db-shm","db-wal","pyc"].includes(i)){this.$toast("\u6587\u4EF6\u683C\u5F0F\u4E0D\u652F\u6301\u7F16\u8F91");return}}this.$router.push({name:"editor",params:{name:l}})},addClick(){this.$dialog(O,{type:"file"})},uploadClick(){this.$dialog(G,{type:"file"})},downloadClick(l){this.api.service.downloadFile(this.absolutePath(l)).then(e=>{this.$toast("Download Success")})}})},fe=D(z(L({},ve),{name:"FileList",setup(l){return(e,i)=>{const c=o("va-button"),F=o("va-button-group"),V=o("va-button-dropdown"),m=o("va-card-title"),b=o("mdi-icon"),k=o("va-avatar"),g=o("va-list-item-section"),$=o("va-list-item-label"),u=o("va-chip"),p=o("va-list-item"),f=o("va-list"),v=o("va-card-content"),w=o("va-card");return _(),y(w,null,{default:t(()=>[a(m,null,{default:t(()=>[d(s(r(n).file)+" ",1),a(V,{outline:"",size:"small"},{default:t(()=>[a(F,{size:"small"},{default:t(()=>[a(c,{onClick:e.uploadClick},{default:t(()=>[d(s(r(n).upload),1)]),_:1},8,["onClick"]),a(c,{onClick:e.addClick},{default:t(()=>[d(s(r(n).add),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1}),a(v,null,{default:t(()=>[a(f,{style:{"padding-top":"0"}},{default:t(()=>[(_(!0),P(A,null,j(e.fileList,(h,C)=>(_(),y(p,{key:C},{default:t(()=>[a(g,{avatar:""},{default:t(()=>[a(k,{color:"var(--va-primary)"},{default:t(()=>[a(b,{name:h.icon},null,8,["name"])]),_:2},1024)]),_:2},1024),a(g,null,{default:t(()=>[a($,null,{default:t(()=>[U("a",{href:"javascript:;",onClick:S=>e.editClick(h.name),class:"link"},s(h.name),9,me)]),_:2},1024),a($,{caption:""},{default:t(()=>[d(s(h.time)+" ",1),h.size?(_(),y(u,{key:0,flat:"",size:"small"},{default:t(()=>[d(s(h.size),1)]),_:2},1024)):E("",!0)]),_:2},1024)]),_:2},1024),a(g,{icon:""},{default:t(()=>[a(V,{size:"small"},{default:t(()=>[a(F,{outline:"",size:"small"},{default:t(()=>[e.isLocalDir?(_(),y(c,{key:0,onClick:S=>e.browseClick(h.name)},{default:t(()=>[d(s(r(n).browse),1)]),_:2},1032,["onClick"])):E("",!0),a(c,{onClick:S=>e.downloadClick(h.name)},{default:t(()=>[d(s(r(n).download),1)]),_:2},1032,["onClick"]),a(c,{onClick:S=>e.renameClick(h.name)},{default:t(()=>[d(s(r(n).rename),1)]),_:2},1032,["onClick"]),a(c,{onClick:S=>e.deleteClick(h.name)},{default:t(()=>[d(s(r(n).delete),1)]),_:2},1032,["onClick"]),a(c,{onClick:S=>e.editClick(h.name)},{default:t(()=>[d(s(r(n).edit),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})}}}));const he=["src","onError"],ke={data(){return{brands:new Array}},computed:L(L({},M(["folderList","path"])),K(["pathList"])),methods:z(L({},N(["getFileList"])),{showClick(l){this.getFileList(l.name)},addClick(){this.$dialog(O,{type:"dir"})},uploadClick(){this.$dialog(G,{type:"dir"})},deleteClick(){const{pathList:l}=this,{name:e}=l[l.length-1];parent.confirm(n.deleteConfirm(e))&&this.api.service.deleteHassFile(this.path).then(i=>{this.getFileList(l.length-2),this.$toast(i.msg)})},renameClick(){this.$dialog(J,{type:"dir",name:""})},downloadClick(){const{pathList:l}=this,{name:e}=l[l.length-1];parent.confirm(n.downloadConfirm(e))&&this.api.service.downloadFile(this.path).then(i=>{this.$toast("Download Success")})},loadSrc(l){return this.brands.includes(l)?"https://brands.home-assistant.io/_/homeassistant/icon.png":l},loadIcon(l,e){this.brands.push(e),l.target.src="https://brands.home-assistant.io/_/homeassistant/icon.png"}})},Ce=D(z(L({},ke),{name:"FolderList",setup(l){return(e,i)=>{const c=o("va-button"),F=o("va-button-group"),V=o("va-button-dropdown"),m=o("va-card-title"),b=o("mdi-icon"),k=o("va-avatar"),g=o("va-list-item-section"),$=o("va-list-item-label"),u=o("va-chip"),p=o("va-icon"),f=o("va-list-item"),v=o("va-list"),w=o("va-card-content"),h=o("va-card");return _(),y(h,null,{default:t(()=>[a(m,null,{default:t(()=>[d(s(r(n).folder)+" ",1),a(V,{outline:"",size:"small"},{default:t(()=>[a(F,{size:"small"},{default:t(()=>[e.pathList.length>1?(_(),y(c,{key:0,onClick:e.renameClick},{default:t(()=>[d(s(r(n).rename),1)]),_:1},8,["onClick"])):E("",!0),a(c,{onClick:e.uploadClick},{default:t(()=>[d(s(r(n).upload),1)]),_:1},8,["onClick"]),a(c,{onClick:e.downloadClick},{default:t(()=>[d(s(r(n).download),1)]),_:1},8,["onClick"]),e.pathList.length>1?(_(),y(c,{key:1,onClick:e.deleteClick},{default:t(()=>[d(s(r(n).delete),1)]),_:1},8,["onClick"])):E("",!0),a(c,{onClick:e.addClick},{default:t(()=>[d(s(r(n).add),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1}),a(w,null,{default:t(()=>[a(v,{style:{"padding-top":"0"}},{default:t(()=>[(_(!0),P(A,null,j(e.folderList,(C,S)=>(_(),y(f,{key:S},{default:t(()=>[a(g,{avatar:""},{default:t(()=>[C.iconType=="img"?(_(),P("img",{key:0,class:"brands",src:e.loadSrc(C.icon),onError:x=>e.loadIcon(x,C.icon)},null,40,he)):(_(),y(k,{key:1,color:"var(--va-primary)"},{default:t(()=>[a(b,{name:C.icon},null,8,["name"])]),_:2},1024))]),_:2},1024),a(g,null,{default:t(()=>[a($,null,{default:t(()=>[d(s(C.name),1)]),_:2},1024),a($,{caption:""},{default:t(()=>[d(s(C.time)+" ",1),C.size?(_(),y(u,{key:0,flat:"",size:"small"},{default:t(()=>[d(s(C.size),1)]),_:2},1024)):E("",!0)]),_:2},1024)]),_:2},1024),a(g,{icon:""},{default:t(()=>[a(p,{name:"remove_red_eye",color:"gray",onClick:x=>e.showClick(C)},null,8,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})}}}));var be=T(Ce,[["__scopeId","data-v-6489c322"]]);const ge={class:"row"},ye={class:"flex md6"},$e={class:"flex md6"},we={computed:L({},K(["pathList"])),created(){this.changePathClick(0)},methods:z(L({},N(["getFileList"])),{changePathClick(l){this.getFileList(l)},versionClick(){this.$dialog(ce)}})},ze=D(z(L({},we),{name:"index",setup(l){return(e,i)=>{const c=o("va-button"),F=o("va-breadcrumbs-item"),V=o("va-breadcrumbs"),m=o("va-card-title"),b=o("va-card"),k=o("va-backtop");return _(),y(le,{class:"views-index"},{left:t(()=>[a(c,{color:"#fff",flat:"",rounded:!1,onClick:e.versionClick},{default:t(()=>[d(s(r(n).name),1)]),_:1},8,["onClick"])]),right:t(()=>[]),default:t(()=>[a(b,null,{default:t(()=>[a(m,null,{default:t(()=>[a(V,null,{default:t(()=>[(_(!0),P(A,null,j(e.pathList,(g,$)=>(_(),y(F,{label:g.name,key:$,onClick:u=>e.changePathClick($)},null,8,["label","onClick"]))),128))]),_:1})]),_:1})]),_:1}),U("div",ge,[U("div",ye,[a(be)]),U("div",$e,[a(fe)])]),a(k,{target:"#va-app-bar-shadow","vertical-offset":"20px","horizontal-offset":"20px","visibility-height":1,speed:50})]),_:1})}}}));export{ze as default};
